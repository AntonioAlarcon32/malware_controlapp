import sys
import json
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QLabel
from PyQt5.QtCore import QUrl
from PyQt5.QtWebSockets import QWebSocket

class CounterApp(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()
        self.initWebSocket()

    def initUI(self):
        self.layout = QVBoxLayout(self)
        self.counterLabel = QLabel("Waiting for updates...", self)
        self.layout.addWidget(self.counterLabel)

    def initWebSocket(self):
        self.webSocket = QWebSocket()
        self.webSocket.textMessageReceived.connect(self.onTextMessageReceived)
        self.webSocket.open(QUrl("ws://127.0.0.1:3000/socket.io/?EIO=3&transport=websocket"))

    def onTextMessageReceived(self, message):
        # Process the message
        data = json.loads(message)
        self.counterLabel.setText(f"Endpoint1: {data['endpoint1_count']}, Endpoint2: {data['endpoint2_count']}")

if __name__ == '__main__':
    app = QApplication(sys.argv)
    ex = CounterApp()
    ex.show()
    sys.exit(app.exec_())
